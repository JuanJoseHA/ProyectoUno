version: '3.8'
services:
  app:
    # ... (el resto del bloque app es el mismo)
    build: .
    container_name: restaurante-app
    ports:
      - "8080:8080"
    environment:
      # URL de la base de datos (usa 'mysql' como host)
      SPRING_DATASOURCE_URL: jdbc:mysql://mysql:3306/restaurantejpa?serverTimezone=UTC&useUnicode=true&characterEncoding=UTF-8
      # 游뚿 CAMBIO CR칈TICO: Usar un usuario no-root que se crea autom치ticamente
      SPRING_DATASOURCE_USERNAME: restaurante_user 
      SPRING_DATASOURCE_PASSWORD: pass1234 # La contrase침a sigue siendo la misma
      # Variable que la clase ProductoServiceJpa utiliza para guardar las fotos
      PATH_PRODUCTO_IMAGENES: /app/imagenes_subidas 
    depends_on:
      - mysql
    # Soluci칩n al error de condici칩n de carrera
    command: sh -c "sleep 30 && java -jar /app/app.jar"
    # Mapea el volumen persistente para las im치genes de productos
    volumes:
      - imagenes_persistentes:/app/imagenes_subidas 
    restart: always

  mysql:
    image: mysql:8.0
    container_name: restaurante-db
    environment:
      # Credenciales de la base de datos
      MYSQL_ROOT_PASSWORD: pass1234 
      MYSQL_DATABASE: restaurantejpa
      # 游뚿 NUEVAS L칈NEAS: Crean el usuario 'restaurante_user' con acceso remoto.
      MYSQL_USER: restaurante_user
      MYSQL_PASSWORD: pass1234
      # Configuraci칩n de zona horaria
      TZ: America/Mexico_City
    # ... (el resto del bloque mysql es el mismo)
    ports:
      - "3307:3306"
    volumes:
      # Volumen para persistir los datos de la base de datos
      - datos_mysql:/var/lib/mysql
    restart: always

# ... (Bloque volumes es el mismo)
volumes:
  datos_mysql:
  imagenes_persistentes: