<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Búsquedas de Clientes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    .hidden{display:none!important}
    .card-form{max-width:780px;margin:auto}
  </style>
</head>
<body class="bg-light">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

<div th:replace="fragmentos/header :: siteHeader('cliente','busqueda')"></div>
  <div class="container py-4">
    <h1 class="mb-3 text-center">Búsquedas con métodos JPA</h1>

    <!-- Selector -->
    <div class="card shadow-sm card-form mb-4">
      <div class="card-body">
        <label for="selector" class="form-label fw-semibold">Tipo de búsqueda</label>
        <select id="selector" class="form-select">
          <option value="" selected>— Elegir —</option>
          <option value="f1">1) Nombre exacto</option>
          <option value="f2">2) Nombre contiene</option>
          <option value="f3">3) Email exacto</option>
          <option value="f4">4) Email termina con</option>
          <option value="f5">5) Crédito entre</option>
          <option value="f6">6) Crédito ≥ monto</option>
          <option value="f7">7) Solo destacados</option>
          <option value="f8">8) Nombre contiene & crédito ≥</option>
          <option value="f9">9) Foto igual a</option>
          <option value="f10">10) Destacados con crédito ≥</option>
          <option value="f11">11) Top 5 por crédito</option>
        </select>
      </div>
    </div>

    <!-- Formularios -->
    <div id="forms" class="card shadow-sm card-form">
      <div class="card-header bg-dark text-white">
        <h5 id="titulo-form" class="mb-0">Selecciona un tipo de búsqueda</h5>
      </div>
      <div class="card-body">

        <!-- 1) /busqueda/nombre -->
        <form id="f1" class="busq-form hidden d-grid gap-3" th:action="@{/busqueda/nombre(type='f1')}" method="get">
          <div>
            <label class="form-label">Nombre exacto</label>
            <input class="form-control" name="nombre" placeholder="Ej. Juan" required />
          </div>
          <button class="btn btn-dark">Buscar</button>
        </form>

        <!-- 2) /busqueda/nombrecomo  (param: texto) -->
        <form id="f2" class="busq-form hidden d-grid gap-3" th:action="@{/busqueda/nombrecomo(type='f2')}" method="get">
          <div>
            <label class="form-label">Cadena en nombre</label>
            <input class="form-control" name="texto" placeholder="Ej. an" required />
          </div>
          <button class="btn btn-dark">Buscar</button>
        </form>

        <!-- 3) /busqueda/email -->
        <form id="f3" class="busq-form hidden d-grid gap-3" th:action="@{/busqueda/email(type='f3')}" method="get">
          <div>
            <label class="form-label">Email exacto</label>
            <input class="form-control" type="email" name="email" placeholder="usuario@dominio.com" required/>
          </div>
          <button class="btn btn-dark">Buscar</button>
        </form>

        <!-- 4) /busqueda/emailTerminacion -->
        <form id="f4" class="busq-form hidden d-grid gap-3" th:action="@{/busqueda/emailTerminacion(type='f4')}" method="get">
          <div>
            <label class="form-label">Sufijo del email</label>
            <input class="form-control" name="sufijo" value="@gmail.com" required/>
          </div>
          <button class="btn btn-dark">Buscar</button>
        </form>

        <!-- 5) /busqueda/creditoentre -->
        <form id="f5" class="busq-form hidden d-grid gap-3" th:action="@{/busqueda/creditoentre(type='f5')}" method="get">
          <div class="row g-3">
            <div class="col-sm-6">
              <label class="form-label">Crédito mínimo</label>
              <input class="form-control" type="number" step="0.01" name="min" placeholder="0.00" required/>
            </div>
            <div class="col-sm-6">
              <label class="form-label">Crédito máximo</label>
              <input class="form-control" type="number" step="0.01" name="max" placeholder="1000.00" required/>
            </div>
          </div>
          <button class="btn btn-dark">Buscar</button>
        </form>

        <!-- 6) /busqueda/creditomayor -->
        <form id="f6" class="busq-form hidden d-grid gap-3" th:action="@{/busqueda/creditomayor(type='f6')}" method="get">
          <div>
            <label class="form-label">Crédito mínimo</label>
            <input class="form-control" type="number" step="0.01" name="min" placeholder="200.00" required/>
          </div>
          <button class="btn btn-dark">Buscar</button>
        </form>

        <!-- 7) /busqueda/destacados -->
        <form id="f7" class="busq-form hidden d-grid gap-3" th:action="@{/busqueda/destacados(type='f7')}" method="get">
          <p class="text-muted mb-0">No requiere parámetros.</p>
          <button class="btn btn-dark mt-2">Buscar</button>
        </form>

        <!-- 8) /busqueda/nombreycredito -->
        <form id="f8" class="busq-form hidden d-grid gap-3" th:action="@{/busqueda/nombreycredito(type='f8')}" method="get">
          <div class="row g-3">
            <div class="col-sm-7">
              <label class="form-label">Cadena en nombre</label>
              <input class="form-control" name="nombre" placeholder="Ej. an" required/>
            </div>
            <div class="col-sm-5">
              <label class="form-label">Crédito mínimo</label>
              <input class="form-control" type="number" step="0.01" name="min" placeholder="250.00" required/>
            </div>
          </div>
          <button class="btn btn-dark">Buscar</button>
        </form>

        <!-- 9) /busqueda/foto (default: noimagen.jpg) -->
        <form id="f9" class="busq-form hidden d-grid gap-3" th:action="@{/busqueda/foto(type='f9')}" method="get">
          <div>
            <label class="form-label">Nombre de archivo</label>
            <input class="form-control" name="nombreFoto" value="noimagen.jpg" required/>
          </div>
          <button class="btn btn-dark">Buscar</button>
        </form>

        <!-- 10) /busqueda/destacadoscredito -->
        <form id="f10" class="busq-form hidden d-grid gap-3" th:action="@{/busqueda/destacadoscredito(type='f10')}" method="get">
          <div>
            <label class="form-label">Crédito mínimo</label>
            <input class="form-control" type="number" step="0.01" name="min" placeholder="300.00" required/>
          </div>
          <button class="btn btn-dark">Buscar</button>
        </form>

        <!-- 11) /busqueda/top5credito -->
        <form id="f11" class="busq-form hidden d-grid gap-3" th:action="@{/busqueda/top5credito(type='f11')}" method="get">
          <p class="text-muted mb-0">Muestra los 5 clientes con mayor crédito.</p>
          <button class="btn btn-dark mt-2">Buscar</button>
        </form>

      </div>
    </div>

    <!-- Resultados -->
    <div class="card shadow-sm mt-4">
      <div class="card-header">
        <strong th:text="${titulo} ?: 'Resultados'">Resultados</strong>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-striped align-middle">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre completo</th>
                <th>Email</th>
                <th>Teléfono</th>
                <th>Crédito</th>
                <th>Destacado</th>
                <th>Foto</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="c : ${resultado}">
                <td th:text="${c.id}">1</td>
                <td th:text="${c.nombre + ' ' + c.apellidos}">Juan Pérez</td>
                <td th:text="${c.email}">a@b.com</td>
                <td th:text="${c.telefono}">xxx</td>
                <td th:text="${c.credito}">0.00</td>
                <td th:text="${c.destacado}">1</td>
                <td>
					<img th:src="@{/imagenes/cliente/{tmpImg} (tmpImg = ${c.fotoCliente})}" 
            		widt="80" height="80"
            		onerror="this.onerror=null; this.src='/imagenes/noimagen.png';">
				</td>
              </tr>
              <tr th:if="${resultado == null or #lists.isEmpty(resultado)}">
                <td colspan="7" class="text-center text-muted">Sin resultados</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>

  <script>
    const selector = document.getElementById('selector');
    const forms = document.querySelectorAll('.busq-form');
    const titulo = document.getElementById('titulo-form');
    const titulos = {
      f1:'1) Nombre exacto',
      f2:'2) Nombre contiene',
      f3:'3) Email exacto',
      f4:'4) Email termina con',
      f5:'5) Crédito entre',
      f6:'6) Crédito ≥ monto',
      f7:'7) Solo destacados',
      f8:'8) Nombre contiene & crédito ≥',
      f9:'9) Foto igual a',
      f10:'10) Destacados con crédito ≥',
      f11:'11) Top 5 por crédito'
    };

    function mostrar(id){
      forms.forEach(f=>f.classList.add('hidden'));
      if(!id){ titulo.textContent = 'Selecciona un tipo de búsqueda'; return; }
      const form = document.getElementById(id);
      if(form){
        form.classList.remove('hidden');
        titulo.textContent = titulos[id] || 'Formulario';
        const first = form.querySelector('input,select,textarea,button');
        if(first) first.focus({preventScroll:true});
        form.scrollIntoView({behavior:'smooth', block:'start'});
      }
    }

    selector.addEventListener('change', e => mostrar(e.target.value));

    // Mantener abierto el formulario tras buscar (usa type=fX añadido en th:action)
    const params = new URLSearchParams(window.location.search);
    const type = params.get('type');
    if(type && document.getElementById(type)){ selector.value = type; mostrar(type); }
  </script>
  <div th:replace="fragmentos/footer :: siteFooter()"></div>
</body>
</html>
