<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<body>
  <div th:fragment="reservaTableFragment(reservas, mostrarAcciones, tablaClass)">
    <table th:class="'table table-sm table-hover ' + (tablaClass != null ? tablaClass : '')">
      <thead>
        <tr>
          <th>ID</th>
          <th>Fecha</th>
          <th>Hora</th>
          <th>Cliente</th>
          <th>Mesa</th>
          <th>Estatus</th>
          <th th:if="${mostrarAcciones}">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr th:if="${#lists.isEmpty(reservas)}">
          <td colspan="7" class="text-center text-muted">Sin reservas</td>
        </tr>

        <tr th:each="r : ${reservas}">
          <td th:text="${r.idservicio}">1</td>
          <td th:text="${r.fecha}">2025-10-21</td>
          <td th:text="${r.hora}">12:00</td>
          <td th:text="${r.cliente != null ? r.cliente.nombre : 'N/A'}">Cliente</td>
          
          <td th:text="${r.mesa != null ? r.mesa.idmesa : 'N/A'}">Mesa</td>
          
          <td th:text="${r.estatus != null ? (r.estatus.getClass().isEnum() ? r.estatus.name() : r.estatus) : 'N/A'}">Estatus</td>

          <td th:if="${mostrarAcciones}">
           
            
            <div th:if="${r.estatus.name() == 'Pendiente'}">
            
             <a th:href="@{'/reservas/editar/' + ${r.idservicio}}" class="btn btn-sm btn-primary mb-1 d-block">Editar</a>
            
                <form th:action="@{'/reservas/confirmar/' + ${r.idservicio}}"
                      method="post"
                      class="d-block mb-1"
                      onsubmit="return confirm('¿Desea confirmar la reserva? Esto la marcará como Confirmada.');">
                    <button type="submit" class="btn btn-sm btn-success w-100">Confirmar</button>
                </form>

                <form th:action="@{'/reservas/eliminar/' + ${r.idservicio}}"
                      method="post"
                      class="d-block mb-1"
                      onsubmit="return confirm('¡ADVERTENCIA! ¿Está seguro que desea CANCELAR la reserva? Esta acción NO se puede deshacer.');">
                    <button type="submit" class="btn btn-sm btn-danger w-100">Cancelar</button>
                </form>
            </div>

            <div th:if="${r.estatus.name() == 'Confirmada'}">
            <a th:href="@{/pedidos/nuevo(clienteId=${r.cliente.id}, reservaId=${r.idservicio})}" 
                   class="btn btn-sm btn-info w-100 mb-1 d-block">Crear Pedido</a>
                <form th:action="@{'/reservas/desconfirmar/' + ${r.idservicio}}"
                      method="post"
                      class="d-block mb-1"
                      onsubmit="return confirm('¿Desea CANCELAR la confirmación y mover la reserva a estado PENDIENTE?');">
                    <button type="submit" class="btn btn-sm btn-danger w-100">Cancelar (Pendiente)</button>
                </form>
            </div>
            
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</body>
</html>